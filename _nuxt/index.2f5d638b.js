import{c as Y}from"./client-only.cec9dd5b.js";import{a as N,o as b,b as g,e as k,f as F,u,E as $,h as P,D as X,i as Q,j as m,r as ne,k as O,w as de,l as pe,m as M,p as te,q as K,F as le,s as me,B as ve,t as L,v as fe,x as be,y as ge,z as we}from"./entry.e199343f.js";import{s as ke}from"./seo.5f5eda7a.js";const ye=k("label",{class:"text-xs uppercase tracking-widest"},"Difficulty",-1),Se={class:"flex"},Pe={__name:"DifficultyToggle.client",props:{easy:{type:Boolean,default:!1},dang:{type:Boolean,default:!1},damn:{type:Boolean,default:!1}},setup(c){const e=N(),t=()=>{e.setDifficulty($)},s=()=>{e.setDifficulty(X)},i=()=>{e.setDifficulty(Q)};return(r,o)=>(b(),g("div",null,[ye,k("div",Se,[c.easy?(b(),g("div",{key:0,class:F(["cursor-pointer text-sm font-bold p-1 grow text-center select-none",{"bg-easy":u(e).selectedDifficulty===u($)}]),onClick:t}," EASY ",2)):P("",!0),c.dang?(b(),g("div",{key:1,class:F(["cursor-pointer text-sm font-bold p-1 grow text-center select-none",{"bg-dang":u(e).selectedDifficulty===u(X)}]),onClick:s}," DANG ",2)):P("",!0),c.damn?(b(),g("div",{key:2,class:F(["cursor-pointer text-sm font-bold p-1 grow text-center select-none",{"bg-damn":u(e).selectedDifficulty===u(Q)}]),onClick:i}," DAMN ",2)):P("",!0)])]))}},qe={__name:"DifficultyDescription.client",props:{easy:{type:Boolean,default:!1},dang:{type:Boolean,default:!1},damn:{type:Boolean,default:!1}},setup(c){const e=c,t=N(),s=m(()=>e.easy&&t.selectedDifficulty===$),i=m(()=>e.dang&&t.selectedDifficulty===X),r=m(()=>e.damn&&t.selectedDifficulty===Q),o=m(()=>s.value||i.value||r.value);return(a,l)=>u(o)?(b(),g("div",{key:0,class:F(["text-xs font-bold text-gray-700 px-1 pt-1 last:pb-1",{"bg-easy":u(s),"bg-dang":u(i),"bg-damn":u(r)}])},[ne(a.$slots,"default")],2)):P("",!0)}},xe=["a","b","c","d","e","f","g","h"],Ie=["1","2","3","4","5","6","7","8"],J=()=>`${xe[Math.floor(Math.random()*8)]}${Ie[Math.floor(Math.random()*8)]}`,V={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class f{constructor(e=V.empty){this.squares=new Array(64).fill(null),this.setFen(e)}setFen(e=V.empty){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let s=0;s<8;s++){const i=t[7-s].replace(/\d/g,r=>{const o=parseInt(r);let a="";for(let l=0;l<o;l++)a+="-";return a});for(let r=0;r<8;r++){const o=i.substring(r,r+1);let a=null;o!=="-"&&(o.toUpperCase()===o?a=`w${o.toLowerCase()}`:a=`b${o}`),this.squares[s*8+r]=a}}}getFen(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){const r=this.squares[t*8+i];if(!r)s++;else{s>0&&(e[7-t]+=s,s=0);const o=r.substring(0,1),a=r.substring(1,2);o==="w"?e[7-t]+=a.toUpperCase():e[7-t]+=a}}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(e=["k","q","r","b","n","p"]){const t=[],s=(i,r)=>e.indexOf(i.name)-e.indexOf(r.name);for(let i=0;i<64;i++){const r=this.squares[i];r&&t.push({name:r.charAt(1),color:r.charAt(0),position:f.indexToSquare(i)})}return e&&t.sort(s),t}movePiece(e,t){if(!this.squares[f.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[f.squareToIndex(t)]=this.squares[f.squareToIndex(e)],this.squares[f.squareToIndex(e)]=null}setPiece(e,t){this.squares[f.squareToIndex(e)]=t}getPiece(e){return this.squares[f.squareToIndex(e)]}static squareToIndex(e){const t=f.squareToCoordinates(e);return t[0]+t[1]*8}static indexToSquare(e){return this.coordinatesToSquare([Math.floor(e%8),e/8])}static squareToCoordinates(e){const t=e.charCodeAt(0)-97,s=e.charCodeAt(1)-49;return[t,s]}static coordinatesToSquare(e){const t=String.fromCharCode(e[0]+97),s=String.fromCharCode(e[1]+49);return t+s}clone(){const e=new f;return e.squares=this.squares.slice(0),e}}class Ee{constructor(){this.position=new f,this.orientation=void 0,this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.moveInputCallback=null,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}inputEnabled(){return this.inputWhiteEnabled||this.inputBlackEnabled}invokeExtensionPoints(e,t={}){const s=this.extensionPoints[e],i=Object.assign({},t);i.extensionPoint=e;let r=!0;if(s)for(const o of s)o(i)===!1&&(r=!1);return r}}const se="http://www.w3.org/2000/svg";class d{static createSvg(e=void 0){let t=document.createElementNS(se,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s={}){let i=document.createElementNS(se,t);t==="use"&&(s["xlink:href"]=s.href);for(let r in s)if(s.hasOwnProperty(r))if(r.indexOf(":")!==-1){const o=r.split(":");i.setAttributeNS("http://www.w3.org/1999/"+o[0],o[1],s[r])}else i.setAttribute(r,s[r]);return e.appendChild(i),i}static removeElement(e){if(!e){console.warn("removeElement, element is",e);return}e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}const v={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",beforeRedrawBoard:"beforeRedrawBoard",afterRedrawBoard:"afterRedrawBoard",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class Me{constructor(e){this.chessboard=e}registerExtensionPoint(e,t){e===v.redrawBoard&&(console.warn("EXTENSION_POINT.redrawBoard is deprecated, use EXTENSION_POINT.afterRedrawBoard"),e=v.afterRedrawBoard),this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){console.warn("registerMethod is deprecated, just add methods directly to the chessboard instance"),this.chessboard[e]?log.error("method",e,"already exists"):this.chessboard[e]=(...s)=>t.apply(this,s)}}class A{static delegate(e,t,s,i){const r=function(o){let a=o.target;for(;a&&a!==this;)a.matches(s)&&i.call(a,o),a=a.parentNode};return e.addEventListener(t,r),{remove:function(){e.removeEventListener(t,r)}}}static mergeObjects(e,t){const s=i=>i&&typeof i=="object";if(!s(e)||!s(t))return t;for(const i of Object.keys(t))t[i]instanceof Object&&Object.assign(t[i],A.mergeObjects(e[i],t[i]));return Object.assign(e||{},t),e}static createDomElement(e){const t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;const s=new Promise(function(i,r){e=i,t=r});return s.resolve=e,s.reject=t,s}static isAbsoluteUrl(e){return e.indexOf("://")!==-1||e.startsWith("/")}}const W={start:"start",frame:"frame",end:"end"};class Ce{constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}async enqueue(e){return new Promise((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}const e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}}const I={move:0,appear:1,disappear:2};class G{constructor(e,t,s,i,r){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=r,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s),this.view.positionsAnimationTask=A.createTask(),this.view.chessboard.state.invokeExtensionPoints(v.animation,{type:W.start})}static seekChanges(e,t){const s=[],i=[],r=[];for(let o=0;o<64;o++){const a=e[o],l=t[o];l!==a&&(l&&s.push({piece:l,index:o}),a&&i.push({piece:a,index:o}))}return s.forEach(o=>{let a=8,l=null;i.forEach(w=>{if(o.piece===w.piece){const h=G.squareDistance(o.index,w.index);h<a&&(l=w,a=h)}}),l?(i.splice(i.indexOf(l),1),r.push({type:I.move,piece:o.piece,atIndex:l.index,toIndex:o.index})):r.push({type:I.appear,piece:o.piece,atIndex:o.index})}),i.forEach(o=>{r.push({type:I.disappear,piece:o.piece,atIndex:o.index})}),r}createAnimation(e,t){const s=G.seekChanges(e,t),i=[];return s.forEach(r=>{const o={type:r.type};switch(r.type){case I.move:o.element=this.view.getPieceElement(f.indexToSquare(r.atIndex)),o.element.parentNode.appendChild(o.element),o.atPoint=this.view.indexToPoint(r.atIndex),o.toPoint=this.view.indexToPoint(r.toIndex);break;case I.appear:o.element=this.view.drawPieceOnSquare(f.indexToSquare(r.atIndex),r.piece),o.element.style.opacity=0;break;case I.disappear:o.element=this.view.getPieceElement(f.indexToSquare(r.atIndex));break}i.push(o)}),i}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e);const t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(r=>{r.type===I.disappear&&d.removeElement(r.element)}),this.view.positionsAnimationTask.resolve(),this.view.chessboard.state.invokeExtensionPoints(v.animation,{type:W.end}),this.callback();return}const s=Math.min(1,t/this.duration);let i=s<.5?2*s*s:-1+(4-2*s)*s;(isNaN(i)||i>.99)&&(i=1),this.animatedElements.forEach(r=>{if(r.element)switch(r.type){case I.move:r.element.transform.baseVal.removeItem(0);const o=this.view.svg.createSVGTransform();o.setTranslate(r.atPoint.x+(r.toPoint.x-r.atPoint.x)*i,r.atPoint.y+(r.toPoint.y-r.atPoint.y)*i),r.element.transform.baseVal.appendItem(o);break;case I.appear:r.element.style.opacity=Math.round(i*100)/100;break;case I.disappear:r.element.style.opacity=Math.round((1-i)*100)/100;break}else console.warn("animatedItem has no element",r)}),this.view.chessboard.state.invokeExtensionPoints(v.animation,{type:W.frame,progress:i})}static squareDistance(e,t){const s=e%8,i=Math.floor(e/8),r=t%8,o=Math.floor(t/8);return Math.max(Math.abs(o-i),Math.abs(r-s))}}class Te extends Ce{constructor(e){super(),this.chessboard=e}async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(i=>{let r=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(r=r/(1+Math.pow(this.queue.length/5,2))),new G(this.chessboard.view,e,t,s?r:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()})}))}async enqueueTurnBoard(e,t,s){return super.enqueue(()=>new Promise(i=>{const r=new f(V.empty);let o=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(o=o/(1+Math.pow(this.queue.length/5,2))),new G(this.chessboard.view,e,r,s?o:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(r.squares),new G(this.chessboard.view,r,e,s?o:0,()=>{this.chessboard.view.redrawPieces(e.squares),i()})})}))}}const n={waitForInputStart:"waitForInputStart",pieceClickedThreshold:"pieceClickedThreshold",clickTo:"clickTo",secondClickThreshold:"secondClickThreshold",dragTo:"dragTo",clickDragTo:"clickDragTo",moveDone:"moveDone",reset:"reset"},R={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"},ie=4;class _e{constructor(e){this.view=e,this.chessboard=e.chessboard,this.moveInputState=null,this.fromSquare=null,this.toSquare=null,this.setMoveInputState(n.waitForInputStart)}moveInputStartedCallback(e){const t=this.view.moveInputStartedCallback(e);return t&&(this.chessboard.state.moveInputProcess=A.createTask(),this.chessboard.state.moveInputProcess.then(s=>{(this.moveInputState===n.waitForInputStart||this.moveInputState===n.moveDone)&&this.view.moveInputFinishedCallback(this.fromSquare,this.toSquare,s)})),t}movingOverSquareCallback(e,t){this.view.movingOverSquareCallback(e,t)}validateMoveInputCallback(e,t){const s=this.view.validateMoveInputCallback(e,t);return this.chessboard.state.moveInputProcess.resolve(s),s}moveInputCanceledCallback(e,t,s){this.view.moveInputCanceledCallback(e,t,s),this.chessboard.state.moveInputProcess.resolve()}setMoveInputState(e,t=void 0){const s=this.moveInputState;switch(this.moveInputState=e,e){case n.waitForInputStart:break;case n.pieceClickedThreshold:if(n.waitForInputStart!==s&&n.clickTo!==s)throw new Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.fromSquare=t.square,this.toSquare=null,this.movedPiece=t.piece,this.startPoint=t.point,!this.pointerMoveListener&&!this.pointerUpListener){if(t.type==="mousedown")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if(t.type==="touchstart")this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener))}else throw Error("94ad0c");break;case n.clickTo:this.draggablePiece&&(d.removeElement(this.draggablePiece),this.draggablePiece=null),s===n.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case n.secondClickThreshold:if(n.clickTo!==s)throw new Error("moveInputState");this.startPoint=t.point;break;case n.dragTo:if(n.pieceClickedThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case n.clickDragTo:if(n.secondClickThreshold!==s)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled()&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case n.moveDone:if([n.dragTo,n.clickTo,n.clickDragTo].indexOf(s)===-1)throw new Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?this.chessboard.movePiece(this.fromSquare,this.toSquare,s===n.clickTo).then(()=>{s===n.clickTo&&this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(n.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(n.reset));break;case n.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=null,this.toSquare=null,this.movedPiece=null,this.draggablePiece&&(d.removeElement(this.draggablePiece),this.draggablePiece=null),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=null),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=null),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=null),this.setMoveInputState(n.waitForInputStart);const i=this.view.piecesGroup.querySelectorAll("[visibility=hidden]");for(let r=0;r<i.length;r++)i[r].removeAttribute("visibility");break;default:throw Error(`260b09: moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece already exists");this.draggablePiece=d.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),s=d.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),i=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,r=this.draggablePiece.createSVGTransform();r.setScale(i,i),s.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if(!(e.type==="mousedown"&&e.button===0||e.type==="touchstart"))return;const t=e.target.getAttribute("data-square");if(!t)return;const s=this.chessboard.getPiece(t);let i;if(s&&(i=s?s.substring(0,1):null,(i==="w"&&this.chessboard.state.inputWhiteEnabled||i==="b"&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault()),this.moveInputState!==n.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&i==="w"||this.chessboard.state.inputBlackEnabled&&i==="b"){let r;if(e.type==="mousedown"?r={x:e.clientX,y:e.clientY}:e.type==="touchstart"&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===n.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(n.pieceClickedThreshold,{square:t,piece:s,point:r,type:e.type});else if(this.moveInputState===n.clickTo)if(t===this.fromSquare)this.setMoveInputState(n.secondClickThreshold,{square:t,piece:s,point:r,type:e.type});else{const o=this.chessboard.getPiece(t),a=o?o.substring(0,1):null,l=this.chessboard.getPiece(this.fromSquare),w=l?l.substring(0,1):null;i&&w===a?(this.moveInputCanceledCallback(this.fromSquare,t,R.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(n.pieceClickedThreshold,{square:t,piece:o,point:r,type:e.type}):this.setMoveInputState(n.reset)):this.setMoveInputState(n.moveDone,{square:t})}}}onPointerMove(e){let t,s,i,r,o;if(e.type==="mousemove"?(i=e.clientX,r=e.clientY,t=e.pageX,s=e.pageY,o=e.target):e.type==="touchmove"&&(i=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,o=document.elementFromPoint(i,r)),this.moveInputState===n.pieceClickedThreshold||this.moveInputState===n.secondClickThreshold)(Math.abs(this.startPoint.x-i)>ie||Math.abs(this.startPoint.y-r)>ie)&&(this.moveInputState===n.secondClickThreshold?this.setMoveInputState(n.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(n.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled()&&this.moveDraggablePiece(t,s));else if(this.moveInputState===n.dragTo||this.moveInputState===n.clickDragTo||this.moveInputState===n.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){const a=o.getAttribute("data-square");a!==this.fromSquare&&a!==this.toSquare?(this.toSquare=a,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):a===this.fromSquare&&this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null))}else this.toSquare!==null&&(this.toSquare=null,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled()&&(this.moveInputState===n.dragTo||this.moveInputState===n.clickDragTo)&&this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if(e.type==="mouseup"?t=e.target:e.type==="touchend"&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const s=t.getAttribute("data-square");if(s)this.moveInputState===n.dragTo||this.moveInputState===n.clickDragTo?this.fromSquare===s?this.moveInputState===n.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(s,null,R.draggedBack),this.setMoveInputState(n.reset)):this.setMoveInputState(n.clickTo,{square:s}):this.setMoveInputState(n.moveDone,{square:s}):this.moveInputState===n.pieceClickedThreshold?this.setMoveInputState(n.clickTo,{square:s}):this.moveInputState===n.secondClickThreshold&&(this.setMoveInputState(n.reset),this.moveInputCanceledCallback(s,null,R.secondClick));else{this.view.redrawPieces();const i=this.fromSquare;this.setMoveInputState(n.reset),this.moveInputCanceledCallback(i,null,R.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(n.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(n.reset),this.moveInputCanceledCallback(this.fromSquare,null,R.secondaryClick)}isDragging(){return this.moveInputState===n.dragTo||this.moveInputState===n.clickDragTo}destroy(){this.setMoveInputState(n.reset)}}class Le{constructor(e){this.chessboard=e,this.visualMoveInput=new _e(this),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.container=document.createElement("div"),this.chessboard.context.appendChild(this.container),e.props.responsive&&(typeof ResizeObserver<"u"?(this.resizeObserver=new ResizeObserver(()=>{setTimeout(()=>{this.handleResize()})}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.positionsAnimationTask=Promise.resolve(),this.pointerDownListener=this.pointerDownHandler.bind(this),this.pointerDownListener=this.pointerDownHandler.bind(this),this.container.addEventListener("mousedown",this.pointerDownListener),this.container.addEventListener("touchstart",this.pointerDownListener,{passive:!1}),this.createSvgAndGroups(),this.handleResize()}pointerDownHandler(e){this.visualMoveInput.onPointerDown(e)}destroy(){this.visualMoveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),d.removeElement(this.svg)}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){const s=document.createElement("div");s.style.transform="scale(0)",s.style.position="absolute",s.setAttribute("aria-hidden","true"),s.id=e,document.body.appendChild(s);const i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=d.createSvg(this.container);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=d.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=d.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=d.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=d.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=d.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=d.addElement(this.svg,"g",{class:"markers-top-layer"}),this.interactiveTopLayer=d.addElement(this.svg,"g",{class:"interactive-top-layer"})}updateMetrics(){const e=this.chessboard.props.style.pieces.tileSize;this.width=this.container.clientWidth,this.height=this.container.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===B.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===B.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.container.style.width=this.chessboard.context.clientWidth+"px",this.container.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.container.clientWidth!==this.width||this.container.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.chessboard.state.invokeExtensionPoints(v.beforeRedrawBoard),this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(v.afterRedrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(d.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===B.frame){const t=this.borderSize;d.addElement(this.boardGroup,"rect",{x:t,y:t,width:this.width-t*2,height:this.height-t*2}).setAttribute("class","border-inner")}for(let t=0;t<64;t++){const s=this.chessboard.state.orientation===_.white?t:63-t,r=`square ${9*s&8?"white":"black"}`,o=this.squareToPoint(f.indexToSquare(s)),a=d.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});a.setAttribute("class",r),a.setAttribute("data-square",f.indexToSquare(s))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==B.frame;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,i=this.height-this.scalingY*3.5,r="coordinate file";e&&(s=s+this.scalingX*15.5,r+=t%2?" white":" black");const o=d.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===_.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===B.frame?(s=s+this.scalingX*10,i=i-this.scalingY*15):(s=s+this.scalingX*2,i=i-this.scalingY*15));const o=d.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:`font-size: ${this.scalingY*10}px`});this.chessboard.state.orientation===_.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(e=this.chessboard.state.position.squares){const t=Array.from(this.piecesGroup.childNodes),s=this.visualMoveInput.isDragging();for(let i=0;i<64;i++){const r=e[i];if(r){const o=f.indexToSquare(i);this.drawPieceOnSquare(o,r,s&&o===this.visualMoveInput.fromSquare)}}for(const i of t)this.piecesGroup.removeChild(i)}drawPiece(e,t,s){const i=d.addElement(e,"g",{});i.setAttribute("data-piece",t);const r=this.svg.createSVGTransform();r.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(r);const o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),a=d.addElement(i,"use",{href:`${o}#${t}`,class:"piece"}),l=this.svg.createSVGTransform();return l.setScale(this.scalingY,this.scalingY),a.transform.baseVal.appendItem(l),i}drawPieceOnSquare(e,t,s=!1){const i=d.addElement(this.piecesGroup,"g",{});i.setAttribute("data-piece",t),i.setAttribute("data-square",e),s&&i.setAttribute("visibility","hidden");const r=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(r.x,r.y),i.transform.baseVal.appendItem(o);const a=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),l=d.addElement(i,"use",{href:`${a}#${t}`,class:"piece"}),w=this.svg.createSVGTransform();w.setTranslate(this.pieceXTranslate,0),l.transform.baseVal.appendItem(w);const h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),l.transform.baseVal.appendItem(h),i}setPieceVisibility(e,t=!0){const s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;const t=this.piecesGroup.querySelector(`g[data-square='${e}']`);return t||(console.warn("no piece on",e),null)}enableMoveInput(e,t=null){if(this.chessboard.state.moveInputCallback)throw Error("moveInput already enabled");t===_.white?this.chessboard.state.inputWhiteEnabled=!0:t===_.black?this.chessboard.state.inputBlackEnabled=!0:(this.chessboard.state.inputWhiteEnabled=!0,this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(v.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.moveInputCallback=null,this.chessboard.state.invokeExtensionPoints(v.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){const t={chessboard:this.chessboard,type:E.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(t.moveInputCallbackResult=this.chessboard.state.moveInputCallback(t)),this.chessboard.state.invokeExtensionPoints(v.moveInput,t),t.moveInputCallbackResult}movingOverSquareCallback(e,t){const s={chessboard:this.chessboard,type:E.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(v.moveInput,s)}validateMoveInputCallback(e,t){const s={chessboard:this.chessboard,type:E.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};return this.chessboard.state.moveInputCallback&&(s.moveInputCallbackResult=this.chessboard.state.moveInputCallback(s)),this.chessboard.state.invokeExtensionPoints(v.moveInput,s),s.moveInputCallbackResult}moveInputCanceledCallback(e,t,s){const i={chessboard:this.chessboard,type:E.moveInputCanceled,reason:s,squareFrom:e,squareTo:t};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(v.moveInput,i)}moveInputFinishedCallback(e,t,s){const i={chessboard:this.chessboard,type:E.moveInputFinished,squareFrom:e,squareTo:t,legalMove:s};this.chessboard.state.moveInputCallback&&this.chessboard.state.moveInputCallback(i),this.chessboard.state.invokeExtensionPoints(v.moveInput,i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===_.white?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){const t=f.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return A.isAbsoluteUrl(this.chessboard.props.style.pieces.file)?this.chessboard.props.style.pieces.file:this.chessboard.props.assetsUrl+this.chessboard.props.style.pieces.file}}const _={white:"w",black:"b"},E={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled",moveInputFinished:"moveInputFinished"},B={none:"none",thin:"thin",frame:"frame"},re={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},Ae={svgSprite:"svgSprite"};class De{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:V.empty,orientation:_.white,responsive:!0,assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:B.none,aspectRatio:1,pieces:{type:Ae.svgSprite,file:"pieces/standard.svg",tileSize:40},animationDuration:300},extensions:[]},A.mergeObjects(this.props,t),this.state=new Ee,this.view=new Le(this),this.positionAnimationsQueue=new Te(this),this.state.orientation=this.props.orientation;for(const s of this.props.extensions)this.addExtension(s.class,s.props);this.view.redrawBoard(),this.state.position=new f(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(v.positionChanged),this.initialized=Promise.resolve()}async setPiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(v.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t,s=!1){const i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(v.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e,t=!1){const s=this.state.position.clone(),i=new f(e);return s.getFen()!==i.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(v.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e,t=!1){const s=this.state.position.clone();if(this.boardTurning){console.warn("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(v.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e,t=void 0){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}addExtension(e,t){if(this.getExtension(e))throw Error('extension "'+e.name+'" already added');this.extensions.push(new e(this,t))}getExtension(e){for(const t of this.extensions)if(t instanceof e)return t;return null}destroy(){this.state.invokeExtensionPoints(v.destroy),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}}const oe=["a","b","c","d","e","f","g","h"],ae=["1","2","3","4","5","6","7","8"],Be=(c,e)=>{if(!c)return[];if(!e)return[];if(c!==re.bn&&c!==re.wn)return[];const t=oe.indexOf(e[0]),s=ae.indexOf(e[1]);return[[t-2,s-1],[t-2,s+1],[t-1,s-2],[t-1,s+2],[t+1,s-2],[t+1,s+2],[t+2,s-1],[t+2,s+1]].filter(([i,r])=>{const o=i>=0&&i<=7,a=r>=0&&r<=7;return o&&a}).map(([i,r])=>`${oe[i]}${ae[r]}`)},z={frame:{class:"marker-frame",slice:"markerFrame"},framePrimary:{class:"marker-frame-primary",slice:"markerFrame"},frameDanger:{class:"marker-frame-danger",slice:"markerFrame"},circle:{class:"marker-circle",slice:"markerCircle"},circlePrimary:{class:"marker-circle-primary",slice:"markerCircle"},circleDanger:{class:"marker-circle-danger",slice:"markerCircle"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class Oe extends Me{constructor(e,t={}){super(e),this.registerExtensionPoint(v.afterRedrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:z.frame,sprite:"extensions/markers/markers.svg"},Object.assign(this.props,t),e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.getSpriteUrl()),e.addMarker=this.addMarker.bind(this),e.getMarkers=this.getMarkers.bind(this),e.removeMarkers=this.removeMarkers.bind(this),this.markerGroupDown=d.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=d.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.props.autoMarkers,this.props.autoMarkers),this.registerExtensionPoint(v.moveInput,s=>{this.drawAutoMarkers(s)}))}drawAutoMarkers(e){e.type!==E.moveInputFinished&&this.removeMarkers(this.props.autoMarkers),!(e.type===E.moveInputStarted&&!e.moveInputCallbackResult)&&(e.type===E.moveInputStarted||e.type===E.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.props.autoMarkers,e.squareFrom),e.squareTo&&this.addMarker(this.props.autoMarkers,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}drawMarker(e){let t;e.type.position==="above"?t=d.addElement(this.markerGroupUp,"g"):t=d.addElement(this.markerGroupDown,"g"),t.setAttribute("data-square",e.square);const s=this.chessboard.view.squareToPoint(e.square),i=this.chessboard.view.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);const r=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),o=d.addElement(t,"use",{href:`${r}#${e.type.slice}`,class:"marker "+e.type.class}),a=this.chessboard.view.svg.createSVGTransform();return a.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(a),t}addMarker(e,t){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new Ge(t,e)),this.onRedrawBoard()}getMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let s=[];return this.markers.forEach(i=>{i.matches(t,e)&&s.push(i)}),s}removeMarkers(e=void 0,t=void 0){if(typeof e=="string"||typeof t=="object"){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(s=>!s.matches(t,e)),this.onRedrawBoard()}getSpriteUrl(){return A.isAbsoluteUrl(this.props.sprite)?this.props.sprite:this.chessboard.props.assetsUrl+this.props.sprite}}class Ge{constructor(e,t){this.square=e,this.type=t}matches(e=void 0,t=void 0){if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}}const Re={class:"relative"},Ue=k("span",null,"Click to play",-1),Fe={__name:"ChessBoard",props:{start:{type:String,default:null},goalMarkers:{type:Array,default:()=>[]},showLegalMoves:{type:Boolean,default:!1}},emits:["start","move","invalidMove"],setup(c,{expose:e,emit:t}){const s=c;let i=null;const r=O(null),o=O(null),a=O(null),l=m(()=>Be(o.value,a.value)),w=O(!1),h=z.frame,p=z.dot,q=z.circlePrimary,S=y=>{if(!i)return;const x=y.target.getAttribute("data-square");if(!x)return;const j=i.getMarkers(h,x);(j==null?void 0:j.length)===0&&(i.removeMarkers(h),i.addMarker(h,x))},C=()=>{i&&i.removeMarkers(h)},T=y=>{if(!i)return;const x=y.target.getAttribute("data-square");l.value.includes(x)?(i.movePiece(a.value,x),t("move",{from:a.value,to:x}),a.value=x):t("invalidMove",{from:a.value,to:x})},Z=()=>{i&&(i.destroy(),r.value.replaceChildren())},H=()=>{i=new De(r.value,{assetsUrl:"/chess/",extensions:[{class:Oe}]}),i.context.addEventListener("mousedown",T),i.context.addEventListener("mouseover",S),i.context.addEventListener("mouseleave",C)},ce=()=>{if(!i)return;o.value=["bn","wn"][Math.floor(Math.random()*2)];let y=s.start||J();for(;s.goalMarkers.includes(y);)y=J();a.value=y,i.setPiece(a.value,o.value,!0)},he=()=>{i&&(i.removeMarkers(q),s.goalMarkers.forEach(y=>{i.addMarker(q,y)}))},ee=()=>{i&&(i.removeMarkers(p),s.showLegalMoves&&l.value.forEach(y=>{i.addMarker(p,y)}))};de(a,()=>{ee()}),pe(()=>{H()});const ue=()=>{w.value=!0,t("start")};return e({ready:()=>{Z(),H(),ce(),he(),ee()},stop:()=>{Z(),H(),w.value=!1}}),(y,x)=>(b(),g("div",Re,[k("div",{ref_key:"boardEl",ref:r},null,512),u(w)?P("",!0):(b(),g("div",{key:0,class:"cursor-pointer bg-gray-300/80 absolute inset-0 flex flex-col items-center justify-center select-none gap-2",onClick:ue},[Ue,ne(y.$slots,"default")]))]))}},$e=Y(Pe),Ne=Y(qe),ze={__name:"BaseHorsey",setup(c){const e=O(null),t=O([]),s=N();let i;const r=m(()=>s.selectedDifficulty<=$),o=()=>{i={start:null,end:null,moves:0,invalidMoves:0,startPerformance:0,endPerformance:0,ms:0}},a=()=>{s.saveFile.addBaseStat(new ve({...i,difficulty:s.selectedDifficulty,date:Date.now()})),o(),e.value.stop()},l=async()=>{o(),t.value=[J()],i.end=t.value[0],i.startPerformance=performance.now(),await me(),e.value.ready()},w=({from:p,to:q})=>{i.moves===0&&(i.start=p),i.moves+=1,t.value[0]===q&&(i.endPerformance=performance.now(),i.ms=i.endPerformance-i.startPerformance,a())},h=()=>{i.invalidMoves+=1};return(p,q)=>{const S=$e,C=Ne,T=Fe;return b(),g(le,null,[k("div",null,[M(S,{easy:"",dang:""}),M(C,{easy:""},{default:te(()=>[K(" Show legal moves ")]),_:1}),M(C,{dang:""},{default:te(()=>[K(" Hide legal moves ")]),_:1})]),M(T,{ref_key:"board",ref:e,"show-legal-moves":u(r),"goal-markers":u(t),class:"mt-2",onStart:l,onMove:w,onInvalidMove:h},null,8,["show-legal-moves","goal-markers"])],64)}}},Ve={class:"rounded-b-lg overflow-hidden w-full origin-bottom-left not-prose"},Ye={class:"relative px-4 bg-white"},He=k("div",{class:"absolute top-1/2 left-0 right-0 bottom-0 bg-black"},null,-1),je={class:"stat text-3xl text-white mix-blend-difference translate-y-[10%] z-10"},We={class:"bg-green-900 h-4 w-full relative"},Xe={class:"text-white font-bold text-xs whitespace-nowrap"},Qe={__name:"StatItem.client",props:{label:{type:String,required:!0},value:{type:Array,required:!0},ratio:{type:Boolean,default:!1},speed:{type:Boolean,default:!1},count:{type:Boolean,default:!1},higherIsBetter:{type:Boolean,default:!1},lowerIsBetter:{type:Boolean,default:!1}},setup(c){const e=c,t=m(()=>{if(e.ratio)return(1-e.value)*100;if(e.speed){const[i,r,o]=e.value;return(r-i)/(o-i)*100}return e.count?0:50}),s=m(()=>{if(e.ratio)return`${(100*e.value[0]).toPrecision(4)}% optimal moves`;if(e.speed){const[i,r,o]=e.value;return`${r.toFixed(2)} ms / game (${o.toFixed(2)} avg slowest, ${i.toFixed(2)} avg fastest)`}return e.count?e.value.join(" "):e.value});return(i,r)=>(b(),g("div",Ve,[k("div",Ye,[He,k("div",je,L(c.label),1)]),k("div",We,[k("div",{class:F(["absolute top-0 bottom-0 left-0 bg-green-700 flex items-center px-4 transition-all",{"rounded-r-full":u(t)>0}]),style:fe({right:`${u(t)}%`})},[k("p",Xe,L(u(s)),1)],6)])]))}},Ke=be("baseStatsStore",()=>{const c=N(),e=m(()=>{var h;return((h=c.saveFile)==null?void 0:h.selectedDifficulty)??$}),t=m(()=>{var p;return Object.values(((p=c.saveFile)==null?void 0:p.baseStats)??{}).filter(({difficulty:q})=>q===e.value)}),s=m(()=>t.value.length),i=m(()=>t.value.sort(({ms:h},{ms:p})=>h-p)),r=m(()=>t.value.reduce((h,{moves:p})=>h+p,0)),o=m(()=>t.value.reduce((h,{invalidMoves:p})=>h+p,0)),a=m(()=>t.value.reduce((h,{optimalMoves:p})=>h+p,0)),l=m(()=>t.value.reduce((h,{ms:p})=>h+p,0));return{baseStats:m(()=>{const h=Math.floor(i.value.length*.1),p=i.value.slice(-1*h).reduce((S,{ms:C,moves:T})=>(S.time+=C,S.moves+=T,S),{time:0,moves:0}),q=i.value.slice(0,h).reduce((S,{ms:C,moves:T})=>(S.time+=C,S.moves+=T,S),{time:0,moves:0});return{allGames:s.value,allMoves:r.value,allInvalidMoves:o.value,allOptimalMoves:a.value,allTime:l.value,allBestMoveRatio:a.value/r.value,allAverageTimePerMove:l.value/r.value,allAverageSlowestTimePerMove:p.time/p.moves,allAverageFastestTimePerMove:q.time/q.moves}}),difficulty:e}}),Je=Y(Qe),Ze={class:"not-prose"},et={key:0,class:"mb-2"},tt={key:1,class:"mb-4"},st={key:2},it={key:3,class:"mb-2"},rt={key:4},ot={key:5,class:"flex flex-col gap-4"},U=10,D=100,at={__name:"StatsDisplay.client",setup(c){const e=Ke(),{baseStats:t}=ge(e),s=m(()=>t.value.allGames>=U+10),i=m(()=>t.value.allGames>=U+10&&t.value.allGames<D),r=m(()=>t.value.allGames>=D),o=m(()=>t.value.allGames>=0),a=m(()=>t.value.allGames>=0&&t.value.allGames<U),l=m(()=>t.value.allGames>=U);return(w,h)=>{const p=Je;return b(),g("div",Ze,[u(s)?(b(),g("h3",et,"Rolling "+L(D)+" Statistics")):P("",!0),u(i)?(b(),g("div",tt," Play at least "+L(D-u(t).allGames)+" more games to see your rolling "+L(D)+" statistics! These statistics are based on your "+L(D)+" most recent games only. ",1)):P("",!0),u(r)?(b(),g("div",st," rolling stats coming soon ")):P("",!0),u(o)?(b(),g("h3",it,"Lifetime Statistics")):P("",!0),u(a)?(b(),g("div",rt," Play at least "+L(U-u(t).allGames)+" more games to see statistics! ",1)):P("",!0),u(l)?(b(),g("div",ot,[M(p,{label:"GAMES",value:["You have played",u(t).allGames,"games. Wow."],count:"","lower-is-better":""},null,8,["value"]),M(p,{label:"SPEED",value:[u(t).allAverageFastestTimePerMove,u(t).allAverageTimePerMove,u(t).allAverageSlowestTimePerMove],speed:"","lower-is-better":""},null,8,["value"]),M(p,{label:"ACCURACY",value:[u(t).allBestMoveRatio],ratio:"","higher-is-better":""},null,8,["value"])])):P("",!0)])}}},nt=Y(at),lt=k("h1",null,"Base Horsey",-1),ct={class:"xl:fixed xl:right-0 xl:top-0 xl:bottom-0 xl:w-full xl:max-w-side xl:overflow-auto z-50"},ht={class:"xl:mx-4 xl:mt-[10.5rem]"},ut=we("<p>The Base Knight game trains you on the basic knight moves.</p><h3>fork knight</h3><p>coming soon - find the square that forks two pieces</p><h3>defense knight</h3><p>coming soon - find a square that defends a piece</p><h3>defended knight</h3><p>coming soon - find a square that defends the knight</p><h3>dodge knight</h3><p>coming soon - get to a square while dodging all no-no squares</p><h3>predict knight</h3><p>coming soon - find a square X moves away from the knight</p>",11),bt={__name:"index",setup(c){ke({pageTitle:"horsey.gg"});const e=N(),t=()=>{e.saveFile.resetBaseStats()};return(s,i)=>{const r=ze,o=nt;return b(),g(le,null,[lt,M(r),k("div",ct,[k("div",ht,[M(o)])]),k("p",null,[K(" Reset stats, test mode only: "),k("button",{type:"button",onClick:t},"Reset stats")]),ut],64)}}};export{bt as default};
